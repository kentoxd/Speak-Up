<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Create New Password</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="create-password-content">
  <div class="create-password-container">
    <div class="form-section">
      
      <!-- Success State -->
      <div *ngIf="showSuccess" class="success-state">
        <div class="success-icon">
          <ion-icon name="mail" size="large" color="primary"></ion-icon>
        </div>
        <h1>Check Your Email</h1>
        <p>We've sent you a password reset link! Check your email and click the link to set your new password.</p>
        <ion-button
          expand="block"
          (click)="goToSignIn()"
          class="success-btn">
          Go to Sign In
        </ion-button>
      </div>

      <!-- Form State -->
      <div *ngIf="!showSuccess">
        <div class="form-header">
          <h1>Create New Password</h1>
          <p>Enter your new password below. We'll send you an email with a link to complete the password reset.</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
          <!-- New Password -->
          <div class="form-group">
            <ion-item>
              <ion-label position="stacked">Create a new password *</ion-label>
              <ion-input
                [type]="showPassword ? 'text' : 'password'"
                formControlName="password"
                placeholder="Enter new password">
              </ion-input>
              <ion-button
                slot="end"
                fill="clear"
                (click)="togglePasswordVisibility()">
                <ion-icon [name]="showPassword ? 'eye-off' : 'eye'" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
            <div class="error-message" *ngIf="getFieldError('password')">
              {{ getFieldError('password') }}
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <ion-item>
              <ion-label position="stacked">Confirm a new password *</ion-label>
              <ion-input
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                placeholder="Confirm new password">
              </ion-input>
              <ion-button
                slot="end"
                fill="clear"
                (click)="toggleConfirmPasswordVisibility()">
                <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
            <div class="error-message" *ngIf="getFieldError('confirmPassword')">
              {{ getFieldError('confirmPassword') }}
            </div>
          </div>

          <!-- Remember Me -->
          <div class="remember-section">
            <ion-checkbox [(ngModel)]="rememberMe" [ngModelOptions]="{standalone: true}"></ion-checkbox>
            <ion-label>Remember me</ion-label>
          </div>

          <!-- Submit Button -->
          <ion-button
            expand="block"
            type="submit"
            [disabled]="passwordForm.invalid || isLoading"
            class="submit-btn">
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <span *ngIf="!isLoading">Continue</span>
          </ion-button>
        </form>
      </div>
    </div>
  </div>
</ion-content>
