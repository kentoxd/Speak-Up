<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Create New Password</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="create-password-content">
  <div class="create-password-container">
    <div class="form-section">
      
      <!-- Success State -->
      <div *ngIf="showSuccess" class="success-state">
        <div class="success-icon">
          <img src="assets/logo/welcome back.png" alt="Welcome Back">
        </div>  
        <h1>Welcome Back!</h1>
        <p>You have successfully reset and created a new password</p>
        <ion-button
          expand="block"
          (click)="goToSignIn()"
          class="success-btn">
          Go to Sign In
        </ion-button>
      </div>

      <!-- Form State -->
      <div *ngIf="!showSuccess">
        <div class="form-header">
          <h1>Create New Password</h1>
          <p>Enter your new password below. We'll send you an email with a link to complete the password reset.</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
          <!-- New Password -->
          <div class="form-group">
            <ion-item>
              <ion-label position="stacked">Create a new password *</ion-label>
              <ion-input
                [type]="showPassword ? 'text' : 'password'"
                formControlName="password"
                placeholder="Enter new password">
              </ion-input>
              <ion-button
                slot="end"
                fill="clear"
                (click)="togglePasswordVisibility()">
                <ion-icon [name]="showPassword ? 'eye-off' : 'eye'" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
            <div class="error-message" *ngIf="getFieldError('password')">
              {{ getFieldError('password') }}
            </div>
            
            <!-- Password Requirements -->
            <div class="password-requirements">
              <p class="requirements-title">Password must contain:</p>
              
              <div class="requirement" [class.met]="isPasswordRequirementMet('uppercase')">
                <ion-icon [name]="isPasswordRequirementMet('uppercase') ? 'checkmark-circle' : 'ellipse-outline'" slot="start"></ion-icon>
                <span>At least one uppercase letter (A-Z)</span>
              </div>
              
              <div class="requirement" [class.met]="isPasswordRequirementMet('lowercase')">
                <ion-icon [name]="isPasswordRequirementMet('lowercase') ? 'checkmark-circle' : 'ellipse-outline'" slot="start"></ion-icon>
                <span>At least one lowercase letter (a-z)</span>
              </div>
              
              <div class="requirement" [class.met]="isPasswordRequirementMet('number')">
                <ion-icon [name]="isPasswordRequirementMet('number') ? 'checkmark-circle' : 'ellipse-outline'" slot="start"></ion-icon>
                <span>At least one number (0-9)</span>
              </div>
              
              <div class="requirement" [class.met]="isPasswordRequirementMet('special')">
                <ion-icon [name]="isPasswordRequirementMet('special') ? 'checkmark-circle' : 'ellipse-outline'" slot="start"></ion-icon>
                <span>At least one special character</span>
              </div>
              
              <div class="requirement" [class.met]="isPasswordRequirementMet('length')">
                <ion-icon [name]="isPasswordRequirementMet('length') ? 'checkmark-circle' : 'ellipse-outline'" slot="start"></ion-icon>
                <span>At least 8 characters</span>
              </div>
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <ion-item>
              <ion-label position="stacked">Confirm a new password *</ion-label>
              <ion-input
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                placeholder="Confirm new password">
              </ion-input>
              <ion-button
                slot="end"
                fill="clear"
                (click)="toggleConfirmPasswordVisibility()">
                <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
            <div class="error-message" *ngIf="getFieldError('confirmPassword')">
              {{ getFieldError('confirmPassword') }}
            </div>
          </div>

          <!-- Remember Me -->
          <div class="remember-section">
            <ion-checkbox [(ngModel)]="rememberMe" [ngModelOptions]="{standalone: true}"></ion-checkbox>
            <ion-label>Remember me</ion-label>
          </div>

          <!-- Submit Button -->
          <ion-button
            expand="block"
            type="submit"
            [disabled]="passwordForm.invalid || isLoading"
            class="submit-btn">
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <span *ngIf="!isLoading">Continue</span>
          </ion-button>
        </form>
      </div>
    </div>
  </div>
</ion-content>