<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{ lesson?.title }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <div class="lesson-container" *ngIf="lesson">
    
    <!-- Back Button -->
    <div class="back-button-container" *ngIf="!showQuiz">
      <ion-button fill="clear" (click)="goBack()">
        <ion-icon slot="start" name="chevron-back"></ion-icon>
        Back
      </ion-button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-header">
      <div class="progress-info">
        <span>{{ getProgressPercentage() }}% Complete</span>
        <ion-chip [color]="lesson.difficulty === 'beginner' ? 'success' : lesson.difficulty === 'intermediate' ? 'warning' : 'danger'" outline>
          {{ lesson.difficulty | titlecase }}
        </ion-chip>
      </div>
      <ion-progress-bar 
        [value]="getProgressPercentage() / 100" 
        color="secondary">
      </ion-progress-bar>
    </div>

    <!-- Lesson Content -->
    <div class="content-area" *ngIf="!showQuiz">
      <div class="content-item" *ngIf="lesson.content[currentContentIndex]">
        <h2>{{ lesson.content[currentContentIndex].title }}</h2>
        
        <div class="content-body">
          <div *ngIf="lesson.content[currentContentIndex].type === 'text'" 
              class="text-content">
            <p style="white-space: pre-line;">{{ lesson.content[currentContentIndex].content }}</p>
          </div>
          
          <div *ngIf="lesson.content[currentContentIndex].type === 'video'" 
               class="video-content">
            <p>{{ lesson.content[currentContentIndex].content }}</p>
            <div class="video-placeholder">
              <ion-icon name="play-circle" color="primary"></ion-icon>
              <p>Video content would be displayed here</p>
            </div>
          </div>
          
          <div *ngIf="lesson.content[currentContentIndex].type === 'audio'" 
               class="audio-content">
            <p>{{ lesson.content[currentContentIndex].content }}</p>
            <div class="audio-placeholder">
              <ion-icon name="volume-high" color="secondary"></ion-icon>
              <p>Audio content would be played here</p>
            </div>
          </div>
          
          <div *ngIf="lesson.content[currentContentIndex].type === 'exercise'" 
               class="exercise-content">
            <div class="exercise-card">
              <ion-icon name="fitness" color="tertiary"></ion-icon>
              <h3>Practice Exercise</h3>
              <p>{{ lesson.content[currentContentIndex].content }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quiz Section -->
  <div class="quiz-area" *ngIf="showQuiz && lesson.quiz">
    <div class="quiz-header">
      <h2>Knowledge Check</h2>
      <p>Test your understanding of this lesson</p>
    </div>
    
    <div class="quiz-questions">
      <div *ngFor="let question of lesson.quiz.questions; let i = index" 
          class="question-card">
        <h3>Question {{ i + 1 }}</h3>
        <p class="question-text">{{ question.question }}</p>
        
        <ion-radio-group 
          [value]="selectedAnswers[i]" 
          (ionChange)="selectAnswer(i, $event.detail.value)">
          <div *ngFor="let option of question.options; let j = index" 
              class="quiz-option-wrapper"
              (click)="selectAnswer(i, j)">
            <div class="quiz-option" [class.selected]="selectedAnswers[i] === j">
              <span class="option-text">{{ option }}</span>
            </div>
          </div>
        </ion-radio-group>
      </div>
    </div>
  </div>

    <!-- Navigation Controls -->
    <div class="navigation-controls" [ngClass]="{'quiz-mode': showQuiz}">
      <!-- Previous Button - Hidden during quiz -->
      <ion-button 
        *ngIf="!showQuiz"
        [disabled]="!canGoPrev()" 
        fill="outline" 
        (click)="prevContent()">
        <ion-icon name="chevron-back" slot="start"></ion-icon>
        Previous
      </ion-button>

      <!-- Next button (only show when NOT on last content or quiz) -->
      <ion-button 
        *ngIf="!showQuiz && canGoNext()"
        fill="solid" 
        (click)="nextContent()">
        Next
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-button>

      <!-- Start Quiz button (show on last content when quiz exists) -->
      <ion-button 
        *ngIf="shouldShowStartQuizButton()"
        fill="solid" 
        color="tertiary"
        (click)="nextContent()">
        Start Quiz
        <ion-icon name="play" slot="end"></ion-icon>
      </ion-button>

      <!-- Submit Quiz button (show during quiz when all answered) -->
      <ion-button 
        *ngIf="showQuiz && !quizCompleted"
        [disabled]="!canGoNext()"
        fill="solid" 
        color="success"
        (click)="submitQuiz()">
        Submit Quiz
        <ion-icon name="checkmark-circle" slot="end"></ion-icon>
      </ion-button>

      <!-- Complete Lesson button (show when no quiz OR after quiz completed) -->
      <ion-button 
        *ngIf="(!lesson.quiz && currentContentIndex === lesson.content.length - 1) || (showQuiz && quizCompleted)"
        fill="solid" 
        color="success"
        (click)="completeLesson()">
        Complete Lesson
        <ion-icon name="checkmark" slot="end"></ion-icon>
      </ion-button>
    </div>

  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="!lesson">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading lesson...</p>
  </div>

</ion-content>